# SPDX-FileCopyrightText: Copyright (c) 2025 Broadsage <opensource@broadsage.com>
#
# SPDX-License-Identifier: Apache-2.0
---
- name: Generate Docker scaffold project structure
  hosts: localhost
  connection: local
  gather_facts: false

  pre_tasks:
    - name: Merge configuration files (defaults.yaml + project.yaml)
      tags: always
      ansible.builtin.command:
        cmd: python3 scripts/config.py
        chdir: /app
      changed_when: false
      register: merge_result

    - name: Display merge output
      tags: always
      ansible.builtin.debug:
        var: merge_result.stdout_lines
      when: merge_result.stdout_lines is defined

    - name: Load merged configuration
      tags: always
      ansible.builtin.include_vars:
        file: "/tmp/merged_config.yaml"

  roles:
    - role: github
      tags:
        - github

    - role: repository
      tags:
        - repository

    - role: compliance
      tags:
        - compliance

    - role: documentation
      tags:
        - documentation

  post_tasks:
    - name: Clean up temporary merged configuration
      tags: always
      ansible.builtin.file:
        path: /tmp/merged_config.yaml
        state: absent

    - name: Display scaffold completion message
      tags: always
      ansible.builtin.debug:
        msg: |
          âœ… Docker scaffold generation completed successfully!
